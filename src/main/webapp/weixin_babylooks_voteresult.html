<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
    <title>大家评评，我家宝宝和我无敌像吗？</title>
    <link href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
    <link href="css/babylooks.css" rel="stylesheet">
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <script src="js/handlebars.min.js"></script>
</head>
<body class="body" style="text-align: center">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src="img/babylooks/share.jpg" width='700'>
</div>
<div style="text-align: center">
    <img class="votebg" src="img/babylooks/bg02.png">

    <div class="vote_name">
        <span>看宝宝和“Ta”哪里最像？</span>
    </div>
    <div class="twopic">
        <img class="piccontrast" src="img/babylooks/pic.png">

        <div id="avatar-content1">
            <img id="avatar1" class="contrast contrast1" src="">
        </div>
        <div id="avatar-content2">
            <img id="avatar2" class="contrast contrast2" src="">
        </div>
    </div>
    <button id="gocommit" class="commitbtn" onclick="toCommit()">去评论</button>
    <div class="showcomments">
        <div id="nocomment" class="contrasts">
            <p><span style="color:#ea7400 ">分享</span>朋友圈，获得好友的评论</p>
            <img class="nocommentimg" src="img/babylooks/fenxiang.png">
        </div>
        <div id="comments" class="contrasts contrasts2">
            <div id="comment" style="height: 120px;overflow: hidden"></div>
            <div id="showallbtn" class="showall" onclick="showall()">全部评论<img class="jiantou2"
                                                                              src="img/babylooks/jiantou1.jpg"></div>
            <div id="hideallbtn" class="hideall" onclick="hideall()">收起评论</div>
        </div>
    </div>
    <div class="reshare">
        <p>看看好友们能否看出</p>
        <p>你和你家宝宝到底哪里最像？</p>
        <img class="jiantou" src="img/babylooks/jiantou.jpg">
        <button id="restart" class="resharebtn" onclick="toEdit()">我要新发起</button>
    </div>
    <script type="text/x-handlebars-template" id="commentList">
        {{#each this}}
        <div class="contrastsinfo">
            <div class="contrastsinfoleft"><span>{{content}}</span></div>
            <div class="contrastsinforight">赞同数：<span class="agreenum">{{count}}</span></div>
        </div>
        {{/each}}
    </script>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     style="overflow: hidden">
    <div class="modal-dialog modal-ewm" role="document" style="height: 100%">
        <button class="close" data-dismiss="modal" aria-label="Close"></button>
        <img class="check" id="check" src="img/babylooks/close.jpg">
    </div>
</div>

<script>


    var commonUrl = "http://xlab-tech.com:45675/fullway-activity/";

    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return (r[2]);
        return null;
    }

    var id = GetQueryString("id");

    if (id != null) {
        var id_ = decodeURIComponent(id);
    }


    function toCommit() {
        location.href = 'weixin_babylooks_comment.html?id=' + id;
    }

    initPage();

    // 初始化页面
    function initPage() {
        if (id) {

            $.get(commonUrl + 'pictureUpload/retrieveUserUploadPicts/' + id, function (data) {
//        console.log(data);
                $('#avatar1').attr('src', data.pict1Url);
                $('#avatar2').attr('src', data.pict2Url);
            })

            $.ajax({
                        type: 'GET',
                        url: commonUrl + 'userPictsComment/list/' + id,
                        success: function (data) {
//                            console.log(data.length);
//                    if(data.length!==0){
                            if (data.length === 8) {
                                $('#nocomment').show();
                                $('#showallbtn').hide();
                                $('#hideallbtn').hide();
                                $('#comments').hide();

                                var newData = [];
                                for (var i = data.length - 8; i < data.length; i++) {
//                                    console.log(data[i].count);
                                    if (data[i].count !== 1) {
                                        newData.push(data[i]);
                                    }
                                }
//                                console.log(newData.length);
                                if (newData.length !== 0) {
                                    $('#nocomment').hide();
                                    $('#showallbtn').hide();
                                    $('#hideallbtn').hide();
                                    $('#comments').show();
                                    if (newData.length > 3) {
                                        $('#nocomment').hide();
                                        $('#comments').show();
                                        $('#showallbtn').show();
                                        $('#hideallbtn').hide();
                                    }
                                    var listTemple = Handlebars.compile($('#commentList').html());
                                    $('#comment').html(listTemple(newData));
                                } else {
                                    $('#nocomment').show();
                                    $('#showallbtn').hide();
                                    $('#hideallbtn').hide();
                                    $('#comments').hide();
                                }
                            }
                            if (data.length > 8 && data.length <= 11) {
                                $('#nocomment').hide();
                                $('#showallbtn').hide();
                                $('#hideallbtn').hide();
                                $('#comments').show();
                                var newData = [];
                                for (var i = 0; i < data.length - 8; i++) {
                                    newData.push(data[i]);
                                }
                                for (var i = data.length - 8; i < data.length; i++) {
                                    if (data[i].count !== 1) {
                                        newData.push(data[i]);
                                    }
                                }
//                              console.log(newData);
                                if (newData.length > 3) {
                                    $('#nocomment').hide();
                                    $('#comments').show();
                                    $('#showallbtn').show();
                                    $('#hideallbtn').hide();
                                }
                                var listTemple = Handlebars.compile($('#commentList').html());
                                $('#comment').html(listTemple(newData));
                            }
                            if(data.length >11){
                                $('#nocomment').hide();
                                $('#showallbtn').show();
                                $('#hideallbtn').hide();
                                $('#comments').show();

                                var newData = [];
                                for (var i = 0; i < data.length - 8; i++) {
                                    newData.push(data[i]);
                                }
                                for (var i = data.length - 8; i < data.length; i++) {
                                    if (data[i].count !== 1) {
                                        newData.push(data[i]);
                                    }
                                }

                                var listTemple = Handlebars.compile($('#commentList').html());
                                $('#comment').html(listTemple(newData));
                            }
                        }
                    }
            );
        }
    }

    //是否显示全部评论


    //全部评论
    function showall() {
        $('#comment').css('height', 'auto');
        $('#showallbtn').hide();
        $('#hideallbtn').show();
    }

//    收起评论
    function hideall(){
        $('#comment').css('height', '120px');
        $('#comment').css('overflow', 'hidden');
        $('#hideallbtn').hide();
        $('#showallbtn').show();
    }

    function toEdit() {
        $('#myModal').modal('show');
    }

</script>
</body>
</html>