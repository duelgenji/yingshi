<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
    <title>刷脸拯救友谊</title>
    <link rel="shortcut icon" href="public/img/favicon.ico">
    <link rel="stylesheet" href="public/css/bootstrap.min.css">
    <link rel="stylesheet" href="public/css/boat_upload.css">
</head>
<body>
<div class="container">

    <div class="boat-title">
        <img src="public/img/boat/boat_title.png"/>
    </div>

    <div class="card-container-two-background">

        <div class="card-container-two">
            <div class="btn-img-add">
            </div>
            <div class="btn-img-add1">
            </div>
            <div id="plan">
                <canvas id="myCanvas"></canvas>
            </div>
            <div id="plan1">
                <canvas id="myCanvas1"></canvas>
            </div>
            <img id="upload-btn" class="add gifjs1" src="http://o84r72kbf.bkt.clouddn.com/boat/20160606161311723">
            <img id="upload-baby" class="add-baby gifjs2" src="http://o84r72kbf.bkt.clouddn.com/boat/20160606161311587">
            <div class="card-back">
                <img class="boat_gif_invisible" src="public/img/boat/boat_gif_tm.png">

                <img class="render" src="http://yingshi.duelgenji.com/res/boat_gif_default_1.png?imageMogr2/thumbnail/500x/strip">
                <img class="original boat-gif-default" src="http://yingshi.duelgenji.com/res/boat_gif_default_1.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-default" src="http://yingshi.duelgenji.com/res/boat_gif_default_2.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-default" src="http://yingshi.duelgenji.com/res/boat_gif_default_3.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-default" src="http://yingshi.duelgenji.com/res/boat_gif_default_4.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-default" src="http://yingshi.duelgenji.com/res/boat_gif_default_5.png?imageMogr2/thumbnail/500x">

                <img class="original boat-gif-rescue-t3" src="http://yingshi.duelgenji.com/res/boat_gif_rescue_t3_1.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-rescue-t3" src="http://yingshi.duelgenji.com/res/boat_gif_rescue_t3_2.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-rescue-t3" src="http://yingshi.duelgenji.com/res/boat_gif_rescue_t3_3.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-rescue-t3" src="http://yingshi.duelgenji.com/res/boat_gif_rescue_t3_4.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-rescue-t3" src="http://yingshi.duelgenji.com/res/boat_gif_rescue_t3_5.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-rescue-t3" src="http://yingshi.duelgenji.com/res/boat_gif_rescue_t3_6.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-rescue-t3" src="http://yingshi.duelgenji.com/res/boat_gif_rescue_t3_7.png?imageMogr2/thumbnail/500x">

                <img class="original boat-gif-refuse" src="http://yingshi.duelgenji.com/res/boat_gif_refuse_1.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-refuse" src="http://yingshi.duelgenji.com/res/boat_gif_refuse_2.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-refuse" src="http://yingshi.duelgenji.com/res/boat_gif_refuse_3.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-refuse" src="http://yingshi.duelgenji.com/res/boat_gif_refuse_4.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-refuse" src="http://yingshi.duelgenji.com/res/boat_gif_refuse_5.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-refuse" src="http://yingshi.duelgenji.com/res/boat_gif_refuse_6.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-refuse" src="http://yingshi.duelgenji.com/res/boat_gif_refuse_7.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-refuse" src="http://yingshi.duelgenji.com/res/boat_gif_refuse_8.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-refuse" src="http://yingshi.duelgenji.com/res/boat_gif_refuse_9.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-refuse" src="http://yingshi.duelgenji.com/res/boat_gif_refuse_10.png?imageMogr2/thumbnail/500x">
                <img class="original boat-gif-refuse" src="http://yingshi.duelgenji.com/res/boat_gif_refuse_11.png?imageMogr2/thumbnail/500x">
            </div>

        </div>


    </div>

    <div class="boat-content">
        <p>— 没想到你是这种霍霍 —</p>
        <p>赶紧送我一辆<span class="boat-content-red">&lt;兰博基尼&gt;</span></p>
        <p>OR发我<span class="boat-content-red">&lt;5.20&gt;</span>的红包!</p>
        <p>我们还能在一起!</p>
        <p>现在 看你咯 <img class="boat-haha" src="public/img/boat/boat_haha.png"/></p>
    </div>


    <div class="button-content">
        <div class="btn-img" id="rescue">
            <img src="public/img/boat/btn_rescue.png">
        </div>
        <div class="btn-img" id="refuse">
            <img src="public/img/boat/btn_refuse.png">
        </div>
    </div>

    <div class="button-content">
        <div class="btn-content">
            <div class="btn-content-c">
                <span class="boat-rescue-list">安迪、大S、尔康</span>共<span class="rescue_number"></span>人帮忙拯救了友谊小船
            </div>
        </div>
        <div class="btn-content">
            <div class="btn-content-c">
                <span class="boat-refuse-list">紫薇、金锁、芈月</span>共<span class="refuse_number"></span>人残忍掀翻了友谊小船
            </div>
        </div>
    </div>



    <div class="boat-bottom">
        <div id="want_play" class="want-play">
            <span class="want-span"><span class="want-span-1">&gt;</span><span class="want-span-2">&gt;</span><span class="want-span-3">&gt;</span>
            </span>
            <span class="want-play-span">我也要玩</span>
        </div>
        <div class="boat-bottom-link"></div>
    </div>

</div>

<!-- Modal -->
<div class="modal my-model" id="rescueModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document" style="width: 100%;height: 100%;margin: 0">
        <div class="modal-content center boat-list">
            <div class="boat-list-close"></div>
            <div class="boat-list-body" style="">
                <div class="boat-list-title">
                    【拯救名单】
                </div>
                <div class="boat-list-names">
                    <div class="boat-list-name">
                        <div class="boat-list-name-l">1.</div>
                        <div class="boat-list-name-r">安迪</div>
                    </div>
                    <div class="boat-list-name">
                        <div class="boat-list-name-l">2.</div>
                        <div class="boat-list-name-r">大S</div>
                    </div>
                    <div class="boat-list-name">
                        <div class="boat-list-name-l">3.</div>
                        <div class="boat-list-name-r">尔康</div>
                    </div>
                </div>

                <div class="boat-list-number">
                    - 共<span class="rescue_number"></span>人拯救 -
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal my-model" id="refuseModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document" style="width: 100%;height: 100%;margin: 0">
        <div class="modal-content center boat-list">
            <div class="boat-list-close"></div>
            <div class="boat-list-body" style="">
                <div class="boat-list-title">
                    【掀翻名单】
                </div>
                <div class="boat-list-names">
                    <div class="boat-list-name">
                        <div class="boat-list-name-l">1.</div>
                        <div class="boat-list-name-r">安迪</div>
                    </div>
                    <div class="boat-list-name">
                        <div class="boat-list-name-l">2.</div>
                        <div class="boat-list-name-r">大S</div>
                    </div>
                    <div class="boat-list-name">
                        <div class="boat-list-name-l">3.</div>
                        <div class="boat-list-name-r">尔康</div>
                    </div>
                </div>
                <div class="boat-list-number">
                    - 共<span class="refuse_number"></span>人掀翻 -
                </div>
            </div>
        </div>
    </div>
</div>

<script src="public/js/jquery.min.js"></script>
<script src="public/js/bootstrap.min.js"></script>
<script src="public/js/common.js"></script>

<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="public/js/wxconfig.js"></script>
<script src="public/js/hashes.min.js"></script>
<script src="public/js/gif.js"></script>
<script src="public/js/boat_example.js"></script>
<script>


    $(document).ready(function(){
        var rescueClickable = false;
        var refuseClickable = false;

        var imgdefereds=[];
        $('img').each(function(){
            var dfd=$.Deferred();
            $(this).bind('load',function(){
                dfd.resolve();
            }).bind('error',function(){
                //图片加载错误，加入错误处理
                // dfd.resolve();
            })
            if(this.complete) setTimeout(function(){
                dfd.resolve();
            },1000);
            imgdefereds.push(dfd);
        });
        $.when.apply(null,imgdefereds).done(function(){
            GIF_init();
            rescueClickable = true;
            refuseClickable = true;
        });

        var openId = GetQueryString("openId");

        var clickTime = 0;


        $('#rescue').on('click', function () {
            updateSystemParam("rescue_number");
            if(!rescueClickable) return;
            rescueClickable = false;
            var _thisImg = $(this).find("img");
            _thisImg.attr("src","public/img/boat/btn_rescue_2.png");
            setTimeout(function(){
                _thisImg.attr("src","public/img/boat/btn_rescue.png");
                rescueClickable = true;
            },200);
            GIF_rescue_t3();
            setTimeout(function(){
                forward();
            },3000);
//            if(clickTime==0){
//            }
//            if(clickTime==1){
//                GIF_rescue_t2();
//            }
//            if(clickTime==2){
//                GIF_rescue_t3();
//            }
//            if(clickTime==3){
//                GIF_rescue_t4();
//            }
//            if(clickTime==4){
//                GIF_rescue_t1();
//                clickTime=0;
//            }
//            clickTime++;
        });

        $('#refuse').on('click', function () {
            updateSystemParam("refuse_number");
            if(!refuseClickable) return;
            refuseClickable = false;
            var _thisImg = $(this).find("img");
            _thisImg.attr("src","public/img/boat/btn_refuse_2.png");
            setTimeout(function(){
                _thisImg.attr("src","public/img/boat/btn_refuse.png");
                refuseClickable = true;
            },200);
            GIF_refuse();
            setTimeout(function(){
                forward();
            },4000);
        });

        $("#want_play").on("click",function(){
            forward();
        });

        function forward(){
            if(openId){
                self.location = "boat_upload.html?openId="+openId;
            }else{
                self.location = "boat_enter.html";
            }
        }

        //底部链接
        $(".boat-bottom-link").on("click",function(){
            self.location="http://m.ys1vs1.icoc.me/index.jsp";
        });

        var current_url = location.href;
        getSystemParam();
        $.ajax({
            url:commonUrl+"wx/getTicket",
            type:"GET",
            success:function(data){
                var SHA1 = new Hashes.SHA1;
                var appId =  "wxa572b73e050e1bb4";
                var timestamp =  parseInt(new Date().getTime()/1000);
                var nonceStr =  createNonceStr();
                var jsapi_ticket = data.token;
                var string = "jsapi_ticket="+jsapi_ticket+"&noncestr="+nonceStr+"&timestamp="+timestamp+"&url="+current_url;
                var signature = SHA1.hex(string);
                wx.config({
                    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                    appId: appId, // 必填，公众号的唯一标识
                    timestamp: timestamp , // 必填，生成签名的时间戳
                    nonceStr: nonceStr, // 必填，生成签名的随机串
                    signature: signature,// 必填，签名，见附录1
                    jsApiList: ["onMenuShareTimeline","onMenuShareAppMessage"] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                });
            }
        });
        wx.ready(function () {

            wx.onMenuShareAppMessage({
                title: '友谊的小船要翻了，赶紧来拯救！', // 分享标题
                link: current_url,
                desc: "友谊的小船说翻就翻，大家都在救，我也要去！",
                imgUrl: 'http://o84r72kbf.bkt.clouddn.com/boat/20160606161311723', // 分享图标
                success: function () {
                }
            });
            wx.onMenuShareTimeline({
                title: '友谊的小船要翻了，赶紧来拯救！', // 分享标题
                link: current_url, // 分享链接
                desc: "友谊的小船说翻就翻，大家都在救，我也要去！",
                imgUrl: 'http://o84r72kbf.bkt.clouddn.com/boat/20160606161311723', // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                }
            });
        });


    });


</script>
</body>
</html>