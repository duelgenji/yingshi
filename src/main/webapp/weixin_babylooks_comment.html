<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
    <title>大家评评，我家宝宝和我无敌像吗？</title>
    <link href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
    <link href="css/babylooks.css" rel="stylesheet">
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <!--<script src="js/babylooks.js"></script>-->
    <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
</head>
<body class="main" style="text-align: center">
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src="img/babylooks/share.jpg" width='700'>
</div>
<img class="votebg" src="img/babylooks/bg02.png">

<div class="commenttxt">
    <div class="importxt">
        <input type="text" id="description" class="iptext" placeholder="最多添加15个字哦" style="color: #000">
        <button id="save" class="importbtn">评论</button>
    </div>
    <div style="height: 336px; overflow: hidden">
        <div id="comment"></div>
    </div>
</div>

</body>
<script src="js/handlebars.min.js"></script>
<script type="text/x-handlebars-template" id="commentList">
    {{#each content}}
    <div style="width: 100%;height: 42px;" class="content-wrapper">
        <div class="content"><span onclick="copy(this);">{{content}}</span></div>
    </div>
    {{/each}}
</script>
<script>

    var commonUrl = "http://xlab-tech.com:45675/fullway-activity/";

    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return (r[2]);
        return null;
    }
    var id = GetQueryString("id");

    initPage();

    // 初始化页面
    function initPage() {
        if (id) {
            $.ajax({
                type: 'GET',
                url: commonUrl + 'userPictsComment/list2/' + id,
                success: function (data) {
                    console.log(data);
                    var listTemple = Handlebars.compile($('#commentList').html());
                    $('#comment').html(listTemple(data));
                }
            })
        }
    }

//    if($('#description').val().length !== 0){
//        $('#description').css('color','black');
//    }else{
//        $('#description').css('color','#ccc');
//    }


    //提交评论
    if (id != null) {
        var id_ = decodeURIComponent(id);
        $('#save').on('click', function () {
            var content = $('#description').val();
            if (content.length === 0) {
                alert('要填写评论哦~');
            } else if (content.length > 15) {
                alert('评论不能超过15个字哦~');
            } else {
                var data = new FormData();
                data.append("content", content);
                data.append("id", id_);
                $.ajax({
                    type: 'POST',
                    url: commonUrl + 'userPictsComment/add',
                    data: data,
                    async: false,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
//                        console.log(JSON.parse(data).success);
                        if (JSON.parse(data).success === true) {
                            $('#description').val('');
                            alert('评论成功');
                            initPage();
                            history.go(-1);
                        } else {
                            alert('评论失败');
                        }
                    },
                    error: function () {
                        alert('评论失败');
                    }
                });
            }
        });
//        $('.content').on('click', function (){
//            $('#description').val('');
//        });
    }

    function copy(div){
//        console.log(div);
        $('#description').val($(div).text());
    }


</script>
</html>